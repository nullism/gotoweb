{{ tpl "header" }}

{{ if .Post }}
{{ .Post.Body }}
{{ else }}
<h1>Search</h1>
{{ end }}


<script>
    const kwminlen = {{.Site.Index.MinKeywordLength}};

    function loadPreviews(hrefs) {
        console.log("fetching ", hrefs)
        fetch(hrefs[0] + ".preview").then(response => response.text()).then(text => {
            document.getElementById("search-results").insertAdjacentHTML('beforeend', text)
            if (hrefs.length > 1) {
                loadPreviews(hrefs.slice(1))
            }
        })
    }

    function submitSearch() {
        var searchText = document.getElementById("search-text").value
        var results = document.getElementById("search-results")
        results.innerHTML = ""
        if (searchText.length <= kwminlen) {
            return
        }

        var hits = search(searchText)
        var hrefs = []
        for (var i = 0; i < hits.length; i++) {
            hrefs.push(hits[i].href)
        }
        // addDocs(0, hrefs)
        loadPreviews(hrefs)


    }
</script>

<div>
    <input type="text" id="search-text" onchange="submitSearch()" placeholder="Search" />
    <button id="search-button" onclick="submitSearch()">Search</button>
</div>

<div id="search-results"></div>

{{ tpl "footer" }}